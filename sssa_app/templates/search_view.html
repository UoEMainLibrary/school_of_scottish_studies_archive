<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/table_style_1.css' %}" >
    <link rel="stylesheet" href="{% static 'css/sub_pages_style.css' %}" >
</head>
<body>

<form method="get" action="">
<h3 style="display:inline; margin-right:10px;">Main word for search:</h3>
<input type="text" name="q" placeholder="Search..." value="{{ query }}"><br>
    <hr>
    <h3>...and add a filter to your searches to narrow down the results:</h3>
    <select name="type_filter">
        <option value="">-- Select Type --</option>
        <option value="ALST" {% if type_filter == "ALST" %}selected{% endif %}>ALST</option>
        <option value="MNDX" {% if type_filter == "MNDX" %}selected{% endif %}>MNDX</option>
    </select>
    <input type="text" name="title_filter" placeholder="Filter by Title..." value="{{ title_filter }}">
    <input type="text" name="informant_filter" placeholder="Filter by Informant Artist..." value="{{ informant_filter }}">
    <hr>


    <button type="submit">Search</button>
</form>
<br>
    {% if query %}
    <p>Found {{ results|length }} result{{ results|pluralize }} for "{{ query }}":</p>
    <table class="table2">
        <thead>
        <tr>
            <th>Type</th>
            <th>Title</th>
            <th>Catalogue Number</th>
            <th>Parent</th>
            <th>Summary</th>
            <th>Informant Artist</th>
            <th>Comments</th>
            <th>Restricted</th>
        </tr>
        </thead>
        <tbody>
        {% for item in results %}

        <tr data-href = "{% url 'alst_details_record' item.id %}?{{ request.GET.urlencode }}">

            <td>{{item.type}}</td>
            <td>{{item.title}}</td>
            <td>{{item.catalogue_number}}</td>
            <td>{% if item.parent == "N/A" %}{% else %}{{ item.parent }}{% endif %}</td>
            <td>
                {% if item.summary and item.summary == "none" %}
                {% else %}
                {{item.summary}}
                {% endif %}
            </td>
            <td>{{item.informant_artist}}</td>
            <td>{{item.comments}}</td>
            <td>
                {% if item.restricted and item.restricted == "none" %}
                No
                {% else %}
                {{item.restricted}}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No search performed yet.</p>
    {% endif %}

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll("tr[data-href]").forEach(row => {
        row.addEventListener("click", function() {
            window.location = this.dataset.href;
        });
    });
});
</script>