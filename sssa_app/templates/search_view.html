<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/table_style_1.css' %}" >
    <link rel="stylesheet" href="{% static 'css/sub_pages_style.css' %}" >
    <link rel="stylesheet" href="{% static 'css/footer.css' %}" >
    <link rel="stylesheet" href="{% static 'css/menu.css' %}" >
</head>
<body>
<div class="div_head">
    {% if user.is_authenticated %}
    <nav style="height: 10%; ">
        <ul>
            <li><a href="{% url 'sssa_home' %}">About</a></li>
            <li><a href="{% url 'search_view' %}">Search</a></li>
            <li><a href="{% url 'collections' %}">Collections</a></li>
            <li><a href="{% url 'people_and_place' %}">People and Place</a></li>
            <li><a href="{% url 'subjects' %}">Subjects</a></li>
            <li><a href="{% url 'listen_recordings' %}">Listen to a recording</a></li>
            <li style="vertical-align: right"><a href="{% url 'logout' %}">Logout</a></li>
        </ul>
    </nav>
    {% else %}
    <nav style="height: 10%">
        <ul>
            <li><a href="{% url 'sssa_home' %}">About</a></li>
            <li><a href="{% url 'collections' %}">Collections</a></li>
            <li><a href="{% url 'people_and_place' %}">People and Place</a></li>
            <li><a href="{% url 'subjects' %}">Subjects</a></li>
            <li><a href="{% url 'listen_recordings' %}">Listen to a recording</a></li>
            <li class="auth-links">
            <a href="{% url 'register' %}">Register</a>
            <a href="{% url 'login' %}">Login</a>
        </li>
        </ul>
    </nav>
    </div>
    {% endif %}
<br>
<br>
<br>
<br>


<div class="div_body" style="margin-left: 5%; margin-right:5%">

<form class="search_form" method="get" action="">
<h3 style="display:inline; margin-right:10px;">Main word for search:</h3>
<input type="text" name="q" placeholder="Search..." value="{{ query }}"><br>
    <hr>
    <h3>...and add a filter to your searches to narrow down the results:</h3>
    <select name="type_filter">
        <option value="">-- Select Type --</option>
        <option value="ALST" {% if type_filter == "ALST" %}selected{% endif %}>ALST</option>
        <option value="MNDX" {% if type_filter == "MNDX" %}selected{% endif %}>MNDX</option>
    </select>
    <input type="text" name="title_filter" placeholder="Filter by Title..." value="{{ title_filter }}">
    <input type="text" name="typematerial_filter" placeholder="Filter by Type of material..." value="{{ typematerial_filter }}">
    <input type="text" name="summary_filter" placeholder="Filter by Summary..." value="{{ summary_filter }}">
    <input type="text" name="informant_filter" placeholder="Filter by Informant Artist..." value="{{ informant_filter }}">
    <input type="text" name="comments_filter" placeholder="Filter by Comments..." value="{{ comments_filter }}">
    <hr>
    <button type="submit">Search</button>
</form>

    <br>
    {% if query %}
    <p>Found {{ results|length }} result{{ results|pluralize }} for "{{ query }}":</p>
    <table class="table2">
        <thead>
        <tr>
            <th>Type</th>
            <th>Title</th>
            <th>Catalogue Number</th>
            <th>Parent</th>
            <th>Type of material</th>
            <th>Summary</th>
            <th>Informant Artist</th>
            <th>Comments</th>
            <th>Restricted</th>
        </tr>
        </thead>
        <tbody>
        {% for item in results %}

        <tr data-href = "{% url 'alst_details_record' item.id %}?{{ request.GET.urlencode }}">

            <td>{{item.type}}</td>
            <td>{{item.title}}</td>
            <td>{{item.catalogue_number}}</td>
            <td>{% if item.parent == "N/A" %}{% else %}{{ item.parent }}{% endif %}</td>
            <td>{{item.type_of_material}}</td>
            <td>
                {% if item.summary and item.summary == "none" %}
                {% else %}
                {{item.summary}}
                {% endif %}
            </td>
            <td>{{item.informant_artist}}</td>
            <td>{{item.comments}}</td>
            <td>
                {% if item.restricted and item.restricted == "none" %}
                No
                {% else %}
                {{item.restricted}}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No search performed yet.</p>
    {% endif %}
</div>

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll("tr[data-href]").forEach(row => {
        row.addEventListener("click", function() {
            window.location = this.dataset.href;
        });
    });
});
</script>