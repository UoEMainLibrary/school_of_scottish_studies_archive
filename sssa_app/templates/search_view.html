<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/table_style_1.css' %}" >
    <link rel="stylesheet" href="{% static 'css/sub_pages_style.css' %}" >
    <link rel="stylesheet" href="{% static 'css/footer.css' %}" >
    <link rel="stylesheet" href="{% static 'css/menu.css' %}" >
    <link rel="stylesheet" href="{% static 'css/search_form.css' %}" >
</head>
<body>
<div class="div_head">
    {% if user.is_authenticated %}
    <nav style="height: 10%; ">
        <ul>
            <li><a href="{% url 'sssa_home' %}">About</a></li>
            <li><a href="{% url 'search_view' %}">Search</a></li>
            <li><a href="{% url 'collections' %}">Collections</a></li>
            <li><a href="{% url 'people_and_place' %}">People and Place</a></li>
            <li><a href="{% url 'subjects' %}">Subjects</a></li>
            <li><a href="{% url 'listen_recordings' %}">Listen to a recording</a></li>
            <li style="vertical-align: right"><a href="{% url 'logout' %}">Logout</a></li>
        </ul>
    </nav>
    {% else %}
    <nav style="height: 10%">
        <ul>
            <li><a href="{% url 'sssa_home' %}">About</a></li>
            <li><a href="{% url 'collections' %}">Collections</a></li>
            <li><a href="{% url 'people_and_place' %}">People and Place</a></li>
            <li><a href="{% url 'subjects' %}">Subjects</a></li>
            <li><a href="{% url 'listen_recordings' %}">Listen to a recording</a></li>
            <li class="auth-links">
            <a href="{% url 'register' %}">Register</a>
            <a href="{% url 'login' %}">Login</a>
        </li>
        </ul>
    </nav>
    </div>
    {% endif %}
<br>
<br>
<br>
<br>


<div class="div_body" style="margin-left: 5%; margin-right:5%">

<form class="search_form" method="get" action="">
  <h3 style="display:inline; margin-right:10px;">Main word for search:</h3>
  <input type="text" name="q" placeholder="Search..." value="{{ query }}">
  <hr>
  <h3>...and add a filter to your searches to narrow down the results:</h3>

  <div class="filters">
    <select name="type_filter">
      <option value="">-- Select Database --</option>
      <option value="ALST" {% if type_filter == "ALST" %}selected{% endif %}>ALST</option>
      <option value="MNDX" {% if type_filter == "MNDX" %}selected{% endif %}>MNDX</option>
    </select>
    <input type="text" name="collection_filter" placeholder="Filter by Collection..." value="{{ collection_filter }}">
    <input type="text" name="informant_artist_filter" placeholder="Filter by Contributor..." value="{{ informant_artist_filter }}">
    <input type="text" name="native_area_county_filter" placeholder="Filter by Native Area..." value="{{ native_area_county_filter }}">
    <input type="text" name="fieldworker_filter" placeholder="Filter by Fieldworker..." value="{{ fieldworker_filter }}">
    <input type="text" name="type_of_material_filter" placeholder="Filter by Subject Keywords..." value="{{ type_of_material_filter }}">
    <input type="text" name="title_filter" placeholder="Filter by Title..." value="{{ title_filter }}">
    <input type="text" name="summary_filter" placeholder="Filter by Summary..." value="{{ summary_filter }}">
    <input type="text" name="catalogue_number_filter" placeholder="Filter by Catalouge Nr..." value="{{ catalogue_number_filter }}">
  </div>

  <hr>
  <button type="submit">Search</button>
</form>

    <br>
    {% if query %}
    <p>Found {{ results|length }} result{{ results|pluralize }} for "{{ query }}":</p>
    <table class="table2">
        <thead>
        <tr>
            <th>SSSA Ref</th>
            <th>Collection</th>
            <th>Collection Ref</th>
            <th>Contributor</th>
            <th>Native Area</th>
            <th>Fieldworker</th>
            <th>Date</th>
            <th>Title</th>
            <th>Content Keywords</th>
            <th>Summary</th>
        </tr>
        </thead>
        <tbody>
        {% for item in results %}

        <tr data-href = "{% url 'alst_details_record' item.id %}?{{ request.GET.urlencode }}">

            <td>{{item.catalogue_number}}</td>
            <td>{{item.collection}}</td>
            <td>{{item.collection_ref}}</td>
            <td>{% if item.informant_artist == "none" %}{% else %}{{ item.informant_artist }}{% endif %}</td>
            <td>{% if item.native_area_county == "none" %}{% else %}{{ item.native_area_county }}{% endif %}</td>
            <td>{% if item.fieldworker == "none" %}{% else %}{{ item.fieldworker }}{% endif %}</td>
            <td>{% if item.date == "none" %}{% else %}{{ item.date }}{% endif %}</td>
            <td>{% if item.title == "none" %}{% else %}{{ item.title }}{% endif %}</td>
            <td>{% if item.type_of_material == "none" %}{% else %}{{ item.type_of_material }}{% endif %}</td>
            <td>{% if item.summary == "none" %}{% else %}{{ item.summaryl }}{% endif %}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No search performed yet.</p>
    {% endif %}
</div>

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll("tr[data-href]").forEach(row => {
        row.addEventListener("click", function() {
            window.location = this.dataset.href;
        });
    });
});
</script>